# Логика функционала PWA для кассиров

Данный документ описывает основной функционал PWA-приложения, предназначенного для работы кассиров, и требования к соответствующей бэкенд-реализации в рамках существующей Clean Architecture.

## 1. Аутентификация и авторизация

*   **Вход владельца/администратора:** Начальная точка входа для пользователей с полными правами доступа к управлению заведением.
*   **Вход сотрудника (кассира):**
    *   Аутентификация осуществляется с использованием 4-значного ПИН-кода.
    *   **Обязательный ввод начальной суммы в кассе:** После успешной аутентификации, кассир должен ввести сумму наличных средств, находящихся в кассе на начало смены. Без этого шага дальнейшая работа в приложении невозможна.
*   **Отслеживание времени смены:** Автоматическая фиксация времени начала и окончания работы сотрудника на смене.
*   **Управление сотрудниками (через админ-панель):**
    *   Функционал для создания, просмотра, редактирования и удаления данных сотрудников: имя, фамилия, номер телефона, должность, 4-значный ПИН-код для доступа к кассе, опционально email.
    *   Управление должностями: возможность определять, создавать, редактировать и удалять должности. Предусмотрена возможность инициализации базовых должностей через скрипт.

## 2. Управление заведением и заказами

*   **Получение настроек заведения (`/me` ручка):** Предоставление информации о конфигурации заведения, включая наличие и параметры использования столиков.
*   **Управление столиками:**
    *   Если в настройках заведения предусмотрены столики, бэкенд должен предоставлять данные для их визуального отображения во фронтенде.
    *   Кассир может выбрать столик для создания нового заказа.
    *   Для выбранного столика указывается количество гостей.
*   **Управление заказами:**
    *   Создание новых заказов (привязанных к столику или общих).
    *   Просмотр списка текущих активных заказов.
    *   **Детализация заказа по гостям:**
        *   Получение каталога товаров по категориям и списка тех-карт.
        *   Возможность добавлять конкретные товары/блюда для каждого отдельного гостя в рамках заказа.
        *   Изменение количества позиций для каждого гостя (увеличение/уменьшение).

## 3. Оплата и закрытие заказов

*   **Методы оплаты:** Поддержка наличной и безналичной (картой) оплаты.
*   **Комбинированная оплата:** Возможность принять оплату частично наличными, частично картой, с фиксацией соответствующих сумм.
*   **Расчет сдачи:** Автоматический расчет суммы сдачи при оплате наличными, если сумма, внесенная клиентом, превышает итоговую стоимость заказа.
*   **Закрытие заказа без оплаты:**
    *   Фиксация факта закрытия заказа без получения оплаты.
    *   **Обязательное указание причины:** Выбор одной из предопределенных причин (например: гость ушел, за счет заведения, ошибка официанта). Суммы по таким заказам должны учитываться как "скидки" или потери в отчетах.

## 4. Управление сменой, отчетность и транзакции

*   **Закрытие смены:**
    *   Кассир инициирует завершение своей рабочей смены.
    *   При закрытии смены кассир должен указать итоговую сумму наличных, которая остается в кассе после проведения инкассации.
    *   Предусмотрена возможность добавления опционального комментария к закрытию смены.
    *   **Автоматическое создание транзакции:** При закрытии смены автоматически формируется транзакция, отражающая перемещение денег (инкассацию) в "денежный ящик" или соответствующий финансовый счет.
*   **Управление транзакциями:**
    *   **API для транзакций:** Отдельный эндпоинт для работы с финансовыми транзакциями.
    *   **Структура транзакции:** Каждая транзакция включает следующие поля:
        *   `Date`: Дата и время совершения транзакции.
        *   `Category`: Категория транзакции (например, "Инкассация", "Внесение начальной суммы", "Возврат", "Расход").
        *   `Comment`: Дополнительный комментарий к транзакции (опционально).
        *   `Amount`: Сумма денежных средств, участвующих в транзакции.
        *   `Account`: Идентификатор или название финансового счета ("денежного ящика"), к которому относится транзакция.
    *   **Функционал транзакций:**
        *   Просмотр всех денежных транзакций за выбранный период.
        *   Возможность редактирования и удаления транзакций (с соответствующими правами доступа).
        *   Просмотр итоговой суммы всех транзакций.
        *   Механизмы фильтрации и поиска транзакций по дате, категории, комментарию и счету.
*   **Генерация отчетов за смену (Архив чеков):**
    *   **Параметры формирования отчета:**
        *   Диапазон дат и времени для формирования отчета (например, "с 01.01.2026 09:00 по 01.01.2026 18:00").
        *   Фильтр по сотруднику: можно выбрать отчет для всех кассиров или для конкретного.
        *   Опция `учесть товары`: Переключатель, определяющий, будет ли в отчете детально отображаться список проданных товаров (если включена) или только общие сводные данные (если выключена).
    *   **Содержание отчета:**
        *   `Кол-во заказов`: Общее количество завершенных заказов за период.
        *   `Итого`: Общая сумма всех заказов до применения скидок.
        *   `Скидки`: Общая сумма потерянной выручки (например, закрытые без оплаты заказы по причинам "за счет заведения", "ошибка официанта" и т.п.).
        *   `С учетом скидок`: Итоговая выручка после вычета скидок (`Итого` - `Скидки`).
        *   `Наличные оплаты`: Общая сумма оплат, принятых наличными.
        *   `Без-нал оплаты`: Общая сумма оплат, принятых безналичным расчетом (картой).
