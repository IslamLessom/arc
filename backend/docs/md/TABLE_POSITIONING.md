# Позиционирование столов на схеме зала

## Обзор

Столы в заведении имеют координаты для визуального отображения на схеме зала в PWA приложении. Это позволяет администратору настроить расположение столов, соответствующее реальной планировке заведения.

## Модель данных

### Координаты стола

```go
type Table struct {
    PositionX float64 // X координата (в пикселях или процентах)
    PositionY float64 // Y координата (в пикселях или процентах)
    Rotation  float64 // Поворот стола в градусах (0-360)
    // ...
}
```

## Системы координат

### Вариант 1: Пиксели (фиксированный размер схемы)

Если схема зала имеет фиксированный размер (например, 1920x1080px):
- `PositionX` = 0-1920
- `PositionY` = 0-1080
- Координаты в пикселях от левого верхнего угла

**Преимущества:**
- Точное позиционирование
- Легко работать с фиксированными размерами

**Недостатки:**
- Не адаптивно для разных размеров экранов
- Нужно пересчитывать при изменении размера схемы

### Вариант 2: Проценты (адаптивная схема)

Если схема адаптивная:
- `PositionX` = 0-100 (% от ширины)
- `PositionY` = 0-100 (% от высоты)
- Координаты в процентах

**Преимущества:**
- Адаптивно для разных размеров экранов
- Не нужно пересчитывать при изменении размера

**Недостатки:**
- Менее точное позиционирование
- Сложнее работать с фиксированными элементами

### Рекомендация

Использовать **проценты** для адаптивности на разных планшетах и размерах экранов.

## Работа с координатами

### Создание заведения

При создании заведения столы создаются с координатами (0, 0):
```go
tables = append(tables, &models.Table{
    EstablishmentID: establishment.ID,
    Number:          i,
    PositionX:       0, // Будет установлено при визуальной расстановке
    PositionY:       0,
    Rotation:        0,
    // ...
})
```

### Расстановка столов

Администратор расставляет столы визуально через интерфейс админ-панели:
1. Открывает схему зала
2. Перетаскивает столы на нужные позиции
3. Поворачивает столы при необходимости
4. Сохраняет изменения

### API для изменения позиции

```
PUT /api/v1/tables/:id/position
```

Запрос:
```json
{
  "position_x": 25.5,  // 25.5% от ширины
  "position_y": 30.2,  // 30.2% от высоты
  "rotation": 45       // Поворот на 45 градусов
}
```

### Получение столов с координатами

```
GET /api/v1/establishments/:id/tables
```

Ответ:
```json
{
  "data": [
    {
      "id": 1,
      "number": 1,
      "position_x": 15.5,
      "position_y": 20.3,
      "rotation": 0,
      "status": "available",
      "capacity": 4
    },
    {
      "id": 2,
      "number": 2,
      "position_x": 45.2,
      "position_y": 20.3,
      "rotation": 90,
      "status": "occupied",
      "capacity": 6
    }
  ]
}
```

## Использование в PWA

### Отображение схемы зала

В PWA приложении:
1. Загружаются столы с координатами через API
2. Создается canvas или SVG для схемы зала
3. Столы отображаются на соответствующих позициях
4. Статусы столов визуально индицируются (цвет, иконка)

### Пример отображения (React/PWA)

```typescript
interface Table {
  id: number;
  number: number;
  position_x: number;
  position_y: number;
  rotation: number;
  status: 'available' | 'occupied' | 'reserved';
  capacity: number;
}

function TableMap({ tables, width, height }: { tables: Table[], width: number, height: number }) {
  return (
    <svg width={width} height={height}>
      {tables.map(table => (
        <g
          key={table.id}
          transform={`translate(${table.position_x * width / 100}, ${table.position_y * height / 100}) rotate(${table.rotation})`}
        >
          <circle
            r={30}
            fill={getStatusColor(table.status)}
            onClick={() => selectTable(table.id)}
          />
          <text>{table.number}</text>
        </g>
      ))}
    </svg>
  );
}
```

## Визуальный редактор в админ-панели

### Функциональность

1. **Drag & Drop** - перетаскивание столов
2. **Rotation** - поворот столов (удержание и вращение)
3. **Grid/Snap** - привязка к сетке (опционально)
4. **Zoom** - масштабирование схемы
5. **Background** - загрузка фонового изображения схемы зала

### Сохранение изменений

При изменении позиции стола:
1. Отправляется запрос `PUT /api/v1/tables/:id/position`
2. Обновляются координаты в базе данных
3. PWA автоматически получает обновленные координаты

## Миграция существующих столов

Если у заведения уже есть столы без координат:
- Можно добавить дефолтные координаты (равномерное распределение)
- Или оставить (0, 0) и администратор расставит вручную

```sql
-- Пример: равномерное распределение 10 столов в сетке 3x4
UPDATE tables 
SET position_x = (number % 3) * 33.33,
    position_y = ((number - 1) / 3) * 25
WHERE establishment_id = ? AND position_x = 0 AND position_y = 0;
```