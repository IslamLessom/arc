# E2E Test для создания заведения

Этот файл содержит полный end-to-end тест, который проверяет весь функционал создания заведения с вопросами для настройки, создания ингредиентов, товаров, тех-карт, остатков, поставщиков, поставок, складов, категорий и т.д.

## Что проверяет тест

Тест проходит через полный цикл создания заведения:

1. **Регистрация пользователя** - создание нового пользователя
2. **Получение вопросов onboarding** - проверка доступности вопросов
3. **Отправка ответов onboarding** - создание заведения на основе ответов
4. **Получение заведения** - проверка создания заведения
5. **Создание категорий** - категории для ингредиентов, товаров и тех-карт
6. **Создание склада** - создание основного склада
7. **Создание поставщика** - добавление поставщика
8. **Создание ингредиентов** - создание 3 ингредиентов с остатками на складе
9. **Создание товаров** - создание 2 товаров с остатками на складе
10. **Создание тех-карт** - создание тех-карты с ингредиентами
11. **Проверка остатков** - проверка наличия остатков на складе
12. **Создание поставки** - добавление поставки ингредиентов
13. **Проверка остатков после поставки** - проверка увеличения остатков
14. **Создание списания** - списание испорченных ингредиентов
15. **Проверка остатков после списания** - проверка уменьшения остатков
16. **Получение движений** - проверка истории движений по складу
17. **Проверка всех созданных сущностей** - финальная верификация

## Требования

- Запущенный сервер на `http://localhost:8080`
- База данных должна быть настроена и доступна
- Все необходимые миграции применены

## Запуск теста

### Вариант 1: Через go test (рекомендуется)

```bash
cd backend
go test -v -short=false -run TestEstablishmentCreationE2E ./e2e_test.go
```

### Вариант 2: С указанием файла

```bash
go test -v -short=false ./e2e_test.go
```

### Вариант 3: С подробным выводом

```bash
go test -v -short=false -run TestEstablishmentCreationE2E ./e2e_test.go -args -test.v
```

## Что создается в процессе теста

- **1 пользователь** с уникальным email
- **1 заведение** (Test Restaurant E2E)
- **3 категории** (для ингредиентов, товаров, тех-карт)
- **1 склад** (Основной склад)
- **1 поставщик** (ООО Поставщик)
- **3 ингредиента** (Морковь, Лук, Картофель) с остатками
- **2 товара** (Хлеб белый, Хлеб черный) с остатками
- **1 тех-карта** (Борщ) с ингредиентами
- **1 поставка** с ингредиентами
- **1 списание** ингредиентов

## Статистика

После выполнения теста выводится статистика:
- Количество созданных сущностей
- ID созданных сущностей (для отладки)

## Примечания

- Тест использует уникальные email адреса для каждого запуска
- Тест проверяет, что сервер запущен перед началом
- Все проверки используют стандартный пакет `testing` без внешних зависимостей
- Тест можно запускать многократно - каждый раз создаются новые данные

## Отладка

Если тест падает, проверьте:
1. Запущен ли сервер на порту 8080
2. Доступна ли база данных
3. Применены ли все миграции
4. Правильно ли настроены переменные окружения

Для более детального вывода используйте флаг `-v` (verbose).
